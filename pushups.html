<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<title>Pushups Test</title>
<script src="stopwatch.js"></script>
<style>
  /* general 4-corner and center areas positioning */
  .area {
    position:absolute;
    margin:0;
    padding:5px;
  }
  .area:nth-child(1) {
      top:0;
      left:0;    
  }
  .area:nth-child(2) {
      top:0;
      right:0;
  }
  .area:nth-child(3) {
      bottom:0;
      left:0;
  }
  .area:nth-child(4) {
      bottom:0;
      right:0;
  }
  .area:nth-child(5) {
      top:50%;
      left:50%;
      transform: translate(-50%,-50%);
  }
  /* specific styles */
  body { font-family: Arial; }
  #mainUI {
      text-align: center;
  }
  #mainUI button {
      min-width: 14em;
      xmin-height: 10em;
  }
  #mainUI #todo {
      font-size: 2.5em;
  }
  #mainUI #stepTime {
      font-size: 10em;
      margin-top: -0.15em;
      margin-bottom: -0.1em;
  }
  input, select, button {
    font-family: inherit;
    font-size: inherit;
  }
  #workoutTitle {
      font-style: italic;
  }
</style>
</head>
<body>
  <div class="area">
    <div id="stepUI"></div>
  </div>
  <div class="area"></div>
  <div class="area">
    Total<br/>
    <span id="curTotalTime"></span> seconds<br/>
    <span id="curTotalPushups"></span> / <span id="totalPushups"></span> pushups
  </div>
  <div class="area">
    <div class="link"><a href="http://www.hundredpushups.com" target="_blank">pushups site</a></div>
    <div class="link" id="fork"><a href="https://github.com/kaicarver/sedfugit/">fork me on Github!</a></div>
  </div>
  <div class="area">
    <div id="mainUI">
      <button onmousedown="nextStep()">
	<div id="todo"></div>
	<div id="stepTime"></div>
      </button>
    </div>
  </div>
  <script>
    var pushupData = [
      { "week" : 3, "day" : 1, "col" : 2, "sets" : [12,17,13,13,17], "rest" : 60 },
      { "week" : 3, "day" : 2, "col" : 2, "sets" : [14,19,14,14,19], "rest" : 90 },
      { "week" : 3, "day" : 3, "col" : 2, "sets" : [16,21,15,15,21], "rest" : 120 },
      { "week" : 4, "day" : 1, "col" : 2, "sets" : [18,22,16,16,25], "rest" : 60 },
      { "week" : 4, "day" : 2, "col" : 2, "sets" : [20,25,20,20,28], "rest" : 90 }
      //{ "week" : 4, "day" : 3, "col" : 2, "sets" : [23,26,23,23,33], "rest" : 120 }
    ];
    for (var j = 0; j < pushupData.length; j++) {
      var sets = pushupData[j].sets;
      var rest = pushupData[j].rest;
      var textSets = [];
      for (var i = 0; i < sets.length; i++) {
	if (i > 0) textSets.push("rest " + rest + " seconds");
	var extra = (i == sets.length - 1) ? "at least " : "";
	textSets.push("do " + extra + sets[i] + " pushups");
      }
      pushupData[j].textSets = textSets;
    }
    //var pushupSet = pushupData[pushupData.length - 1];
    /*

Past exercises, to be stored at some point:

Wed Nov  4 18:02:37 CST 2015
week 3 day 1 level 2
do 12 pushups 24
rest 60 seconds 59
do 17 pushups 34
rest 60 seconds 59
do 13 pushups 30
rest 60 seconds 65
do 13 pushups 29
rest 60 seconds 63
do at least 17 pushups 53
Total
416 seconds
72 / 72 pushups
Note: should have been easy restarting at week 3. It was not super easy towards the end -- barely could do the last set, with a tiny bit of pausing. Still, it's nice to be able to do a full set without totally dying and failing to do it properly. Something to be said for maxxing ou only at the end, not already at the 3d or 4th set.

      */
    var pushupSet = pushupData[1];
    var elems = document.getElementsByClassName("basic");
    var stepUI = document.getElementById("stepUI");
    stepUI.innerHTML += '<div id="workoutTitle"><a href="http://www.hundredpushups.com/week' + pushupSet.week +
      '.html" target="_blank">week '+ pushupSet.week + '</a>' +
      ' day ' + pushupSet.day + ' level ' + pushupSet.col + '</div>';
    for (var i = 0; i < pushupSet.textSets.length; i++) {
      stepUI.innerHTML += '<div id="step' + i + '">' + pushupSet.textSets[i] + ' </div>';
    }
    for (var i = 0; i < pushupSet.textSets.length; i++) {
      new Stopwatch(document.getElementById("step" + i));
    }
    var curStep = -1;
    function nextStep() {
      var todo = document.getElementById("todo");
      if (curStep < pushupSet.textSets.length) {
	if (curStep >= 0) {
	  document.getElementById("step" + curStep).stopwatch.stop();
	}
	curStep++;
	if (curStep < pushupSet.textSets.length) {
	  var s = document.getElementById("step" + curStep);
	  todo.innerText = s.innerText;
	  s.style.backgroundColor = "pink";
	  //new Stopwatch(s).start();
	  s.stopwatch.start();
	}
	if (curStep > pushupSet.textSets.length - 1) {
	  todo.innerText = "";
	}
      }
    }
    function totalTime() {
      var curTotalTime = 0;
      var curTotalPushups = 0;
      var totalPushups = 0;
      for (var i = 0; i < pushupSet.textSets.length; i++) {
	var prevStep = document.getElementById('step' + (i-1));
	var step = document.getElementById('step' + i);
	if (step && step.stopwatch) {
	  curTotalTime += step.stopwatch.time();
	  // only add pushups when step has been done
	  if (prevStep && prevStep.stopwatch.time() > 0 && !prevStep.stopwatch.running() ) {
	    curTotalPushups += 1 * prevStep.stopwatch.pushups();
	  }
	  totalPushups += 1 * step.stopwatch.pushups();
	}
      }
      if (curStep >= pushupSet.textSets.length) {
	// last step was done
	if (step && step.stopwatch) {
	  curTotalPushups += 1 * step.stopwatch.pushups();
	}
      }
      document.getElementById("curTotalTime").innerText = curTotalTime;
      document.getElementById("curTotalPushups").innerText = curTotalPushups;
      document.getElementById("totalPushups").innerText = totalPushups;
    }
    function stepTime() {
      var stepTime = curStep <= 0 ? "Go" : "Done";
      var step = document.getElementById('step' + curStep);
      if (step && step.stopwatch) {
	stepTime = step.stopwatch.render();
      }
      document.getElementById("stepTime").innerHTML = stepTime;
    }
    setInterval(totalTime, 100);   
    setInterval(stepTime, 100);
</script>
</body>
</html>
